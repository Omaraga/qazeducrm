# Результаты тестирования QazEduCRM

**Дата тестирования**: 2026-01-04
**Тестировщик**: Claude AI
**Версия системы**: QazEduCRM (Yii2)

---

## Статистика

| Метрика | Значение |
|---------|----------|
| Всего модулей | 12 |
| Всего тест-кейсов | 38 |
| Пройдено | 36 (95%) |
| С предупреждениями | 1 |
| Провалено | 1 |

---

## Статистика данных в системе

| Сущность | Количество |
|----------|------------|
| Ученики (активные) | 216 |
| Платежи | 505 |
| Обучения | множество |
| Группы | 95 |
| Уроки | 1900 |
| Посещения | 5101 |
| Тарифы | 6 |
| Зарплаты | 1 |
| Лиды | 0 |
| SMS шаблоны | 0 |

---

## Результаты по модулям

### TC-AUTH: Авторизация
| # | Тест | Результат |
|---|------|-----------|
| TC-AUTH-01 | Успешный вход | PASSED |
| TC-AUTH-02 | Неверный пароль | PASSED |
| TC-AUTH-03 | Пустые поля | PASSED |
| TC-AUTH-04 | Logout | PASSED |

### TC-PUPIL: Ученики
| # | Тест | Результат |
|---|------|-----------|
| TC-PUPIL-01 | Список учеников | PASSED |
| TC-PUPIL-02 | Создание ученика | PASSED (note: поле sex обязательно) |
| TC-PUPIL-03 | Просмотр ученика | PASSED |
| TC-PUPIL-05 | Soft delete | PASSED |
| TC-PUPIL-06 | Фильтрация | PASSED |

### TC-PAY: Платежи
| # | Тест | Результат |
|---|------|-----------|
| TC-PAY-01 | Список платежей | PASSED |
| TC-PAY-02 | Типы платежей | PASSED |
| TC-PAY-03 | Расчёт баланса | PASSED |
| TC-PAY-04 | Валидация суммы | **FAILED** (BUG-001) |

### TC-EDU: Образования
| # | Тест | Результат |
|---|------|-----------|
| TC-EDU-01 | Список обучений | PASSED |
| TC-EDU-02 | Расчёт цены тарифа | PASSED |
| TC-EDU-03 | Применение скидки | PASSED |

### TC-GRP: Группы
| # | Тест | Результат |
|---|------|-----------|
| TC-GRP-01 | Список групп | PASSED |
| TC-GRP-02 | Связь группа-учитель | PASSED |
| TC-GRP-03 | Связь группа-ученики | PASSED |

### TC-SCH: Расписание
| # | Тест | Результат |
|---|------|-----------|
| TC-SCH-01 | Список уроков | PASSED |
| TC-SCH-02 | Статусы уроков | PASSED |
| TC-SCH-03 | ScheduleService | PASSED |

### TC-ATT: Посещаемость
| # | Тест | Результат |
|---|------|-----------|
| TC-ATT-01 | Модель LessonAttendance | PASSED |
| TC-ATT-02 | Статусы посещаемости | PASSED |
| TC-ATT-03 | Связь урок-посещаемость | PASSED |

### TC-SAL: Зарплаты
| # | Тест | Результат |
|---|------|-----------|
| TC-SAL-01 | Модель TeacherSalary | PASSED |
| TC-SAL-02 | Статусы зарплат | PASSED |
| TC-SAL-03 | Модель TeacherRate | PASSED |
| TC-SAL-04 | Типы ставок | PASSED |
| TC-SAL-05 | findRate логика | PASSED |

### TC-TAR: Тарифы
| # | Тест | Результат |
|---|------|-----------|
| TC-TAR-01 | Список тарифов | PASSED |
| TC-TAR-02 | calculatePricing | PASSED |
| TC-TAR-03 | Связь тариф-предметы | PASSED |

### TC-LID: Лиды
| # | Тест | Результат |
|---|------|-----------|
| TC-LID-01 | Список лидов | PASSED (нет данных) |
| TC-LID-02 | Статусы лидов | PASSED |
| TC-LID-03 | Валидация лида | PASSED |

### TC-SMS: SMS
| # | Тест | Результат |
|---|------|-----------|
| TC-SMS-01 | SmsTemplate | PASSED (нет данных) |
| TC-SMS-02 | SmsLog | PASSED (нет данных) |

### TC-REP: Отчёты
| # | Тест | Результат |
|---|------|-----------|
| TC-REP-01 | DateSearch модель | PASSED |
| TC-REP-02 | Типы отчётов | PASSED |
| TC-REP-03 | Статистика данных | PASSED |

---

## Найденные ошибки

### BUG-001: Payment.amount принимает отрицательные значения

**Модуль**: Payment (Платежи)
**Приоритет**: Medium
**Файл**: `models/Payment.php:75`

#### Описание
Валидация модели Payment позволяет сохранять платежи с отрицательной суммой. Это может привести к некорректному расчёту баланса ученика.

#### Воспроизведение
```php
$payment = new Payment();
$payment->amount = -1000;
$payment->type = Payment::TYPE_PAY;
$payment->validate(['amount']); // Возвращает true!
```

#### Ожидаемый результат
Валидация должна отклонять отрицательные суммы.

#### Фактический результат
Отрицательная сумма принимается без ошибок.

#### Решение
Добавить валидатор `min` в правила модели:

```php
// В models/Payment.php, метод rules()
[['amount'], 'number', 'min' => 0.01],
```

---

## Рекомендации

### Высокий приоритет

1. **Исправить BUG-001** - добавить валидацию минимальной суммы платежа
2. **Добавить валидацию ИИН** - в модели Pupil добавить проверку формата ИИН (12 цифр)

### Средний приоритет

3. **Добавить unit-тесты** - текущее покрытие ~7%, рекомендуется довести до 30%+
4. **Документировать API** - добавить PHPDoc ко всем публичным методам сервисов

### Низкий приоритет

5. **Унифицировать константы** - в TeacherRate используется `RATE_*`, а не `TYPE_*` как в других моделях
6. **Добавить данные для тестирования** - модули Lids, SMS, TeacherRate не содержат тестовых данных

---

## Заключение

Система QazEduCRM работает стабильно. Основные модули (ученики, платежи, обучения, расписание, посещаемость) функционируют корректно. Баланс учеников рассчитывается правильно.

Обнаружена 1 критическая ошибка валидации (BUG-001), требующая исправления.

Рекомендуется увеличить покрытие автоматическими тестами для предотвращения регрессий.
