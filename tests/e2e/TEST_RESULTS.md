# Результаты E2E тестирования QazEduCRM

**Дата:** 09.01.2026
**Тестировщик:** Claude Code + Playwright MCP
**Версия системы:** QazEduCRM Tailwind
**URL:** http://educrm.loc/

---

## Сводка

| Метрика | Значение |
|---------|----------|
| Всего тестов | 18 |
| Пройдено | 12 |
| Провалено | 6 |
| Критические баги | 5 |
| UX проблемы | 6 |
| Позитивные находки UI | 6 |

**Общий статус: PARTIAL PASS (требуются исправления)**

---

## Тестовые данные

| Параметр | Значение |
|----------|----------|
| Организация | Тест Центр E2E 2026 |
| Organization ID | 5 |
| Админ email | director-e2e-2026@qazedu.kz |
| Админ пароль | Test123456! |
| Тариф | FREE Trial |

---

## Детальные результаты

### Раздел 1: Регистрация и Авторизация

#### TC-1.1: Регистрация новой организации
- **Статус:** PASS
- **URL:** `/register`
- **Результат:** Организация "Тест Центр E2E 2026" успешно зарегистрирована
- **Замечания:** Мастер регистрации с 3 шагами работает корректно

#### TC-1.2: Авторизация в системе
- **Статус:** PASS
- **URL:** `/login`
- **Результат:** Успешный вход, редирект в CRM `/5/default/index`

---

### Раздел 2: Справочники

#### TC-2.x: Создание справочников
- **Статус:** PASS
- **Созданы:**
  - Предмет: "Тестовый предмет E2E" (ID: 22)
  - Кабинет: "Аудитория E2E" (код: E2E-01)
  - Тариф: "Тестовый тариф E2E" (15 000 KZT, ID: 20)
  - Способ оплаты: "Kaspi E2E" (ID: 10)

---

### Раздел 3: Сотрудники

#### TC-3.1: Создание учителя
- **Статус:** PASS
- **URL:** `/5/user/create`
- **Создан:** "Тестовый Учитель" (ID: 43)
- **Замечания:** Пустой action в форме исправлен в предыдущей сессии

---

### Раздел 4: Группы

#### TC-4.x: Создание группы
- **Статус:** PASS
- **Созданы:**
  - Группа: "Тестовая группа E2E" (код: TEST-E2E-01, ID: 121)
  - Учитель добавлен в группу

---

### Раздел 5: Ученики

#### TC-5.x: Ученики и платежи
- **Статус:** PASS (после исправления багов)
- **Созданы:**
  - Ученик: "Ученик Тестовый Тестович" (ID: 327)
  - Обучение: тариф 15 000 KZT, привязан к группе
  - Платёж: 15 000 KZT через Kaspi E2E

**Исправленные баги (предыдущая сессия):**
1. `modules/crm/views/pupil/edu/form.php`:
   - AJAX URL `/tariff/get-info` не содержал organization_id -> исправлено
   - Формат даты HTML5 (YYYY-MM-DD) не соответствовал серверному (dd.mm.yyyy) -> исправлено
2. `modules/crm/views/pupil/payment/form.php`:
   - Формат datetime-local не соответствовал серверному -> исправлено

**Обнаруженные баги UI:**
- Кнопка "Сохранить" в форме оплаты отображалась без текста (только иконка)

---

### Раздел 6: Расписание - КРИТИЧЕСКИЕ БАГИ

#### TC-6.1: Просмотр режимов календаря
- **Статус:** PARTIAL FAIL
- **URL:** `/5/schedule/index`
- **Результаты:**
  - Режим "День" (Д): PASS - фильтры загружаются
  - Режим "Неделя" (Н): PASS - отображает 2 занятия
  - Режим "Месяц" (М): FAIL - фильтры показывают "Нет групп" и "Нет преподавателей"

**БАГ #1: Фильтры не загружаются в режиме Месяц**
- Скриншот: `deep-test-01-schedule-no-groups-bug.png`

#### TC-6.2: Отображение даты занятия
- **Статус:** FAIL
- **Проблема:** Занятие с датой 08.01.2026 отображается на экране 09.01.2026
- **Скриншот:** `deep-test-02-schedule-date-bug.png`

**БАГ #2: КРИТИЧЕСКИЙ - Неправильное отображение даты занятия**
- Занятие создано на 08.01.2026
- Календарь показывает текущую дату 09.01.2026
- Занятие отображается на 09.01 вместо 08.01

#### TC-6.3: Drag&Drop перемещение
- **Статус:** FAIL
- **Проблема:** Перетаскивание занятия не работает
- **Ожидание:** Занятие должно перемещаться на другое время
- **Результат:** Занятие остается на месте

**БАГ #3: Drag&Drop не функционирует**

#### TC-6.4: Отметка посещаемости
- **Статус:** FAIL
- **URL:** `/5/attendance/lesson?id=X`
- **Проблемы:**
  1. В модальном окне занятия НЕТ кнопки "Редактировать посещения"
  2. Сообщение "Нет учеников в этой группе на данную дату" хотя ученик есть
- **Скриншот:** `deep-test-05-lesson-no-attendance-button.png`

**БАГ #4: Невозможно отметить посещаемость**
- Отсутствует кнопка перехода к посещаемости из занятия
- Даже при наличии ученика в группе показывает "Нет учеников"

#### TC-6.5: Модальное окно занятия
- **Статус:** PARTIAL PASS
- **Проблема UX:** Клики проходят сквозь оверлей к фоновым элементам

---

### Раздел 7: Шаблоны расписания

#### TC-7.x: Шаблоны
- **Статус:** PASS
- **Проверено:**
  - Создание шаблона: "Шаблон E2E тестирование" (ID: 4)
  - Добавление типового занятия
  - Мастер генерации (3 шага)
  - Генерация расписания на период

**Ошибка JS (не блокирующая):**
- `updateTeachersForGroup is not defined` - при выборе группы

---

### Раздел 10: Лиды - КРИТИЧЕСКИЙ БАГ

#### TC-10.1: Kanban-доска
- **Статус:** PASS
- **URL:** `/5/lids-funnel/kanban`
- **UI отличный:**
  - Progress bar прогресса лида
  - Быстрые действия
  - Колонки по статусам
  - Метки: VIP, Горячий, Не отвечает, Повторный
- **Скриншот:** `deep-test-06-kanban-board.png`

#### TC-10.2: Карточка лида
- **Статус:** PASS
- **Вкладки:** Инфо, История, Действия, Скрипт
- **Скриншоты:** `deep-test-07-lead-card-info.png`, `deep-test-08-lead-actions-tab.png`

#### TC-10.3: Конверсия в ученика
- **Статус:** FAIL
- **URL:** `/5/lids-funnel/convert-ajax`
- **Шаги:**
  1. Открыть лид -> вкладка "Действия"
  2. Нажать "Оплатил" (последний этап воронки)
  3. Появляется модальное окно "Лид будет конвертирован в ученика"
  4. Подтвердить конверсию
- **Ожидание:** Создается запись Pupil, лид закрывается
- **Результат:** Статус меняется на "Оплатил", но ученик НЕ создается

**БАГ #5: КРИТИЧЕСКИЙ - Конверсия лида не работает**
- Модальное окно обещает: "Лид будет конвертирован в ученика"
- После подтверждения только меняется статус
- Кнопка "Создать ученика" остается доступной
- Ученик фактически не создается
- **JS ошибка в консоли:** `SyntaxError: Failed to execute 'querySelector' on 'Document': '.kanban-card[data-id=452]'`
- **Скриншоты:** `deep-test-09-lead-conversion-modal.png`, `deep-test-10-lead-conversion-bug.png`

#### TC-10.4: Создание лида
- **Статус:** PASS
- **Создан:** "Лид Тестовый E2E" (ID: 452), источник: Instagram

---

### Раздел 11: Зарплата

#### TC-11.1: Информационная страница
- **Статус:** PASS (UI отличный)
- **URL:** `/5/salary/index`
- **Содержимое:** Объяснение workflow: Черновик -> Утверждена -> Выплачена

#### TC-11.2: Страница ставок
- **Статус:** PASS (UI отличный)
- **URL:** `/5/salary/rates`
- **Содержимое:**
  - Объяснение приоритетов: Группа -> Предмет -> Общая ставка
  - Типы ставок с примерами: За ученика, За урок, Процент
- **Скриншот:** `deep-test-11-salary-rates.png`

#### TC-11.3: Создание ставки
- **Статус:** PASS
- **Создано:** За урок 3000 KZT для Тестового Учителя

#### TC-11.4: Расчёт зарплаты
- **Статус:** PASS
- **Период:** 01.01.2026 - 09.01.2026
- **Результат:** 0 уроков, 0 учеников, 0 KZT
- **Причина:** Посещаемость не отмечена (из-за бага #4)
- **Скриншот:** `deep-test-12-salary-detail.png`

#### TC-11.5: Утверждение зарплаты
- **Статус:** PASS
- **Результат:** Статус изменен на "Утверждена"
- **Проблема UX:** Редирект на Dashboard вместо страницы зарплаты

#### TC-11.6: Выплата зарплаты
- **Статус:** PASS
- **Результат:** Статус изменен на "Выплачена"
- **Проблема UX:** Редирект на Dashboard вместо страницы зарплаты
- **Скриншот:** `deep-test-13-salary-paid.png`

---

### Раздел 12: Настройки доступа

#### TC-12.1: Настройки прав
- **Статус:** PASS
- **URL:** `/5/settings/access`
- **Проверено:**
  - Настройки для Администратора и Учителя
  - Мгновенное сохранение при клике
  - Уведомление "Сохранено"

---

## Критические баги

### БАГ #1: Фильтры расписания не загружаются в режиме Месяц
- **Компонент:** Schedule Calendar
- **Файл:** `web/js/schedule-calendar.js`
- **Воспроизведение:**
  1. Перейти в Расписание
  2. Переключить на режим "Месяц"
- **Ожидание:** Фильтры групп и преподавателей загружены
- **Результат:** "Нет групп", "Нет преподавателей"
- **Серьёзность:** HIGH

### БАГ #2: Неправильная дата отображения занятия
- **Компонент:** Schedule Calendar
- **Файл:** `web/js/schedule-calendar.js` или `modules/crm/views/schedule/`
- **Воспроизведение:**
  1. Создать занятие на дату X
  2. Открыть календарь на дату X+1
- **Ожидание:** Занятие отображается на дате X
- **Результат:** Занятие отображается на дате X+1
- **Серьёзность:** CRITICAL

### БАГ #3: Drag&Drop не работает
- **Компонент:** Schedule Calendar
- **Файл:** `web/js/schedule-calendar.js`
- **Воспроизведение:** Попытаться перетащить занятие
- **Ожидание:** Занятие перемещается
- **Результат:** Ничего не происходит
- **Серьёзность:** MEDIUM

### БАГ #4: Невозможно отметить посещаемость
- **Компонент:** Attendance
- **Файлы:**
  - `modules/crm/views/schedule/` (модальное окно)
  - `modules/crm/controllers/AttendanceController.php`
- **Воспроизведение:**
  1. Открыть занятие с учениками
  2. Искать кнопку посещаемости
- **Ожидание:** Кнопка "Редактировать посещения" в модальном окне
- **Результат:** Кнопки нет, показывает "Нет учеников"
- **Серьёзность:** CRITICAL

### БАГ #5: Конверсия лида не создаёт ученика
- **Компонент:** Leads Funnel
- **Файлы:**
  - `modules/crm/controllers/LidsFunnelController.php`
  - `modules/crm/views/lids-funnel/kanban.php`
- **Воспроизведение:**
  1. Открыть лид -> Действия -> "Оплатил"
  2. Подтвердить конверсию в модальном окне
- **Ожидание:** Создаётся запись Pupil
- **Результат:** Только меняется статус, ученик не создаётся
- **JS ошибка:** `querySelector` с невалидным селектором
- **Серьёзность:** CRITICAL

---

## UI/UX Проблемы

### UX-1: Редиректы после действий с зарплатой
- **Описание:** После утверждения/выплаты зарплаты редирект на Dashboard
- **Ожидание:** Редирект на список зарплат или карточку зарплаты
- **Файл:** `modules/crm/controllers/SalaryController.php`

### UX-2: Модальный оверлей пропускает клики
- **Описание:** При открытом модальном окне клики проходят к фоновым элементам
- **Влияние:** Случайные действия при попытке закрыть модальное окно

### UX-3: Alpine.js ошибки в консоли
- **Ошибки:**
  - `formValidation is not defined`
  - `inputClass is not defined`
  - `isSubmitting is not defined`
  - `updateTeachersForGroup is not defined`
- **Влияние:** Формы работают, но без клиентской валидации

### UX-4: Отсутствие обратной связи при Drag&Drop
- **Описание:** При попытке перетаскивания нет визуальной обратной связи
- **Ожидание:** Курсор меняется, элемент "поднимается", placeholder показывает место

### UX-5: Кнопка сохранения без текста в форме оплаты
- **Описание:** При добавлении оплаты кнопка submit отображалась без текста
- **Файл:** `modules/crm/views/pupil/payment/form.php`
- **Ожидание:** Кнопка с текстом "Сохранить"
- **Результат:** Только иконка без текста
- **Влияние:** Непонятно назначение кнопки

### UX-6: Несоответствие текста при регистрации
- **Описание:** На шаге 2 регистрации написано "Введите данные администратора", но создаётся Директор
- **Файл:** `views/registration/index.php`
- **Ожидание:** Текст соответствует создаваемой роли
- **Результат:** Текст говорит "администратор", роль создаётся "Директор" (GENERAL_DIRECTOR)
- **Влияние:** Путаница в терминологии, непонимание роли

---

## Позитивные находки UI/UX

### UI+1: Kanban-доска лидов
- Отличная визуализация воронки продаж
- Progress bar показывает этап лида
- Метки с цветовой кодировкой (VIP, Горячий)
- Быстрые действия на карточке

### UI+2: Страница ставок зарплаты
- Подробное объяснение приоритетов ставок
- Примеры для каждого типа ставки
- Понятная структура информации

### UI+3: Карточка лида с вкладками
- Логичное разделение: Инфо, История, Действия, Скрипт
- История с таймлайном событий
- Воронка с визуальным прогрессом

### UI+4: Dashboard с быстрыми действиями
- Основные метрики на виду
- Быстрые действия для частых операций
- Последние платежи и занятия

### UI+5: Информационные блоки
- Объяснение workflow зарплат
- Tooltips с подсказками
- Описания полей в формах

### UI+6: Единый стиль Tailwind
- Консистентные компоненты
- Правильные цвета для статусов
- Адаптивная вёрстка

---

## Скриншоты

| № | Название | Файл |
|---|----------|------|
| 1 | БАГ: Фильтры не грузятся (Месяц) | deep-test-01-schedule-no-groups-bug.png |
| 2 | БАГ: Неправильная дата занятия | deep-test-02-schedule-date-bug.png |
| 3 | Расписание: Режим Неделя | deep-test-03-schedule-week-view.png |
| 4 | Посещаемость: Инфо страница | deep-test-04-attendance-info-page.png |
| 5 | БАГ: Нет кнопки посещаемости | deep-test-05-lesson-no-attendance-button.png |
| 6 | Kanban-доска лидов | deep-test-06-kanban-board.png |
| 7 | Карточка лида: Инфо | deep-test-07-lead-card-info.png |
| 8 | Карточка лида: Действия | deep-test-08-lead-actions-tab.png |
| 9 | БАГ: Модалка конверсии | deep-test-09-lead-conversion-modal.png |
| 10 | БАГ: Конверсия не работает | deep-test-10-lead-conversion-bug.png |
| 11 | Зарплата: Ставки | deep-test-11-salary-rates.png |
| 12 | Зарплата: Детали | deep-test-12-salary-detail.png |
| 13 | Зарплата: Выплачена | deep-test-13-salary-paid.png |

**Путь к скриншотам:** `.playwright-mcp/`

---

## Рекомендации

### Критические (требуют немедленного исправления)

1. **Исправить отображение даты в расписании**
   - Проверить timezone handling
   - Проверить формат даты при сохранении/загрузке

2. **Добавить кнопку посещаемости в модальное окно занятия**
   - Проверить логику определения учеников в группе на дату
   - Добавить ссылку на страницу посещаемости

3. **Исправить конверсию лида в ученика**
   - Исправить JS ошибку querySelector
   - Реализовать фактическое создание Pupil
   - Связать Pupil с Lids

### Средний приоритет

4. **Исправить Drag&Drop в расписании**
   - Проверить обработчики событий
   - Добавить визуальную обратную связь

5. **Исправить загрузку фильтров в режиме Месяц**
   - Проверить AJAX запросы при смене режима

6. **Исправить редиректы после действий с зарплатой**
   - Возвращать на релевантную страницу

### Низкий приоритет

7. **Подключить Alpine.js компоненты глобально**
   - Определить formValidation, inputClass, isSubmitting

8. **Исправить оверлей модальных окон**
   - Добавить stopPropagation на оверлей

---

## Заключение

Система QazEduCRM имеет хорошую базовую функциональность и приятный UI на базе Tailwind. Однако обнаружены **5 критических багов**, которые блокируют ключевые бизнес-процессы:

### Блокирующие проблемы:
- **Посещаемость невозможно отметить** -> зарплата не считается корректно
- **Конверсия лида не работает** -> воронка продаж не завершается
- **Даты в расписании отображаются некорректно** -> путаница в занятиях

### Работает корректно:
- Регистрация и авторизация
- Управление справочниками
- Создание учеников, групп, учителей
- Платежи
- Шаблоны расписания (генерация)
- Настройки доступа
- Workflow зарплаты (статусы)

### Статус системы: **ТРЕБУЕТСЯ ДОРАБОТКА**

Рекомендуется исправить критические баги перед production использованием.

---

*Отчёт сгенерирован с помощью Claude Code + Playwright MCP*
*Глубокое тестирование 09.01.2026*
