# Комплексное тестирование CRM + SuperAdmin

**Дата начала:** 2026-01-09
**Тестировщик:** Claude Code (Automated)
**Версия:** Pre-launch
**Статус:** КРИТИЧЕСКИЕ ТЕСТЫ ПРОЙДЕНЫ

---

## Тестовые данные

| Параметр | Значение |
|----------|----------|
| URL CRM | http://educrm.loc |
| URL SuperAdmin | http://educrm.loc/superadmin |
| SuperAdmin логин | superadmin |
| SuperAdmin пароль | SuperAdmin2024! |
| Браузер 1 | Chrome (основной) |
| Браузер 2 | Chrome Incognito (SuperAdmin) |

---

## Фаза 1: Регистрация организации

### 1.1 Форма регистрации

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| REG-001 | Открыть http://educrm.loc/register | Форма отображается | [ ] | |
| REG-002 | Отправить пустую форму | Ошибки валидации на обязательных полях | [ ] | |
| REG-003 | Ввести невалидный email организации | Ошибка валидации email | [ ] | |
| REG-004 | Ввести короткий пароль (менее 8 символов) | Ошибка "минимум 8 символов" | [ ] | |
| REG-005 | Ввести несовпадающие пароли | Ошибка "пароли не совпадают" | [ ] | |
| REG-006 | Ввести невалидный БИН (не 12 цифр) | Ошибка валидации БИН | [ ] | |
| REG-007 | Выбрать тарифный план | Планы отображаются и выбираются | [ ] | |
| REG-008 | Не отметить согласие с условиями | Форма не отправляется | [ ] | |
| REG-009 | Заполнить форму корректно | Редирект на страницу успеха | [x] | PASSED |
| REG-010 | Страница успеха отображается | Сообщение "Проверьте email" | [x] | PASSED |

**Тестовые данные для регистрации:**
```
Название организации: Тест Организация 2026
Email организации: test2026@example.com
Телефон: +7 777 123 4567
БИН: 123456789012
Имя админа: Тест
Фамилия админа: Тестов
Email админа: admin.test2026@example.com
Пароль: TestPassword123!
```

### 1.2 Верификация email

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| REG-011 | Письмо отправлено на email организации | Письмо в почте | [ ] | |
| REG-012 | Ссылка в письме корректная | URL содержит token | [x] | PASSED - token в БД |
| REG-013 | Клик по ссылке верификации | Страница "Заявка на рассмотрении" | [x] | PASSED |
| REG-014 | Статус организации в БД | status = 'pending', email_verified_at IS NOT NULL | [x] | PASSED - КРИТИЧЕСКИЙ |
| REG-015 | Повторный клик по ссылке | Показывает страницу ожидания (не ошибку) | [ ] | |

### 1.3 Блокировка входа до одобрения

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| REG-016 | Попытка входа до одобрения | Ошибка "Организация ожидает одобрения" | [x] | PASSED - КРИТИЧЕСКИЙ |
| REG-017 | Ошибка информативная | Показывает название организации | [x] | PASSED |

---

## Фаза 2: SuperAdmin - Одобрение организации

### 2.1 Вход в SuperAdmin

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| SA-001 | Открыть http://educrm.loc/superadmin | Редирект на логин | [x] | PASSED |
| SA-002 | Войти с неверным паролем | Ошибка авторизации | [ ] | Не тестировали |
| SA-003 | Войти с корректными данными | Dashboard отображается | [x] | PASSED |

### 2.2 Dashboard SuperAdmin

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| SA-004 | Статистика организаций | Корректные числа | [x] | PASSED |
| SA-005 | Статистика подписок | Корректные числа | [x] | PASSED |
| SA-006 | Виджет "Ожидают одобрения" | Показывает новую организацию | [x] | PASSED - КРИТИЧЕСКИЙ |
| SA-007 | Счётчик в "Требуют внимания" | Включает заявки на одобрение | [x] | PASSED |
| SA-008 | Кнопка "Одобрить заявки" в быстрых действиях | Отображается если есть заявки | [x] | PASSED |

### 2.3 Список ожидающих одобрения

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| SA-009 | Открыть страницу pending | Список организаций | [x] | PASSED |
| SA-010 | Новая организация в списке | Данные корректные | [x] | PASSED |
| SA-011 | Email статус = Подтверждён | Зелёный бейдж | [x] | PASSED |
| SA-012 | Кнопка "Просмотр" | Открывает детали организации | [x] | PASSED |

### 2.4 Одобрение организации

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| SA-013 | Клик "Одобрить" | Подтверждение действия | [x] | PASSED |
| SA-014 | Подтвердить одобрение | Flash "Организация одобрена" | [x] | PASSED |
| SA-015 | Статус в БД | status = 'active' | [x] | PASSED - КРИТИЧЕСКИЙ |
| SA-016 | Организация исчезла из pending | Список обновился | [x] | PASSED |
| SA-017 | Лог активности | "Организация одобрена администратором" | [x] | PASSED |

### 2.5 Вход пользователя после одобрения

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| SA-018 | Попытка входа после одобрения | Успешный вход | [x] | PASSED - КРИТИЧЕСКИЙ |
| SA-019 | Редирект в CRM | Dashboard организации | [x] | PASSED |
| SA-020 | Пробная подписка активна | Trial status | [x] | PASSED - "Стандарт Trial: 13 дн." |

---

## Фаза 3: SuperAdmin - Управление организациями

### 3.1 CRUD организаций

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| SA-ORG-001 | Список всех организаций | Таблица с организациями | [ ] | |
| SA-ORG-002 | Поиск по названию | Фильтрация работает | [ ] | |
| SA-ORG-003 | Фильтр по статусу | Фильтрация работает | [ ] | |
| SA-ORG-004 | Создание организации | Организация создана | [ ] | |
| SA-ORG-005 | Редактирование организации | Данные обновлены | [ ] | |
| SA-ORG-006 | Удаление организации | Soft delete | [ ] | |
| SA-ORG-007 | Приостановка организации | Status = suspended | [ ] | |
| SA-ORG-008 | Блокировка организации | Status = blocked | [ ] | |
| SA-ORG-009 | Создание филиала | Филиал привязан к HEAD | [ ] | |
| SA-ORG-010 | Impersonate (войти под пользователем) | Работает корректно | [ ] | |

### 3.2 Управление подписками

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| SA-SUB-001 | Список подписок | Таблица отображается | [ ] | |
| SA-SUB-002 | Создание подписки | Подписка создана | [ ] | |
| SA-SUB-003 | Продление подписки | expires_at обновлён | [ ] | |
| SA-SUB-004 | Приостановка подписки | Status = suspended | [ ] | |
| SA-SUB-005 | Отмена подписки | Status = cancelled | [ ] | |
| SA-SUB-006 | Список запросов на подписку | Таблица отображается | [ ] | |
| SA-SUB-007 | Одобрение запроса | Status = approved | [ ] | |
| SA-SUB-008 | Отклонение запроса | Status = rejected + комментарий | [ ] | |

### 3.3 Управление платежами

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| SA-PAY-001 | Список платежей | Таблица отображается | [ ] | |
| SA-PAY-002 | Создание платежа | Платёж создан (pending) | [ ] | |
| SA-PAY-003 | Подтверждение платежа | Status = completed, подписка продлена | [ ] | |
| SA-PAY-004 | Возврат платежа | Status = refunded | [ ] | |
| SA-PAY-005 | Бонус менеджера рассчитан | bonus_amount > 0 | [ ] | |

### 3.4 Тарифы и промокоды

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| SA-PLAN-001 | Список тарифов | Планы отображаются | [ ] | |
| SA-PLAN-002 | Редактирование тарифа | Данные обновлены | [ ] | |
| SA-PROMO-001 | Список промокодов | Таблица отображается | [ ] | |
| SA-PROMO-002 | Создание промокода | Промокод создан | [ ] | |
| SA-PROMO-003 | Активация/деактивация | Статус меняется | [ ] | |

### 3.5 Аналитика

| ID | Тест | Ожидаемый результат | Статус | Комментарий |
|----|------|---------------------|--------|-------------|
| SA-REV-001 | Dashboard выручки | Метрики отображаются | [ ] | |
| SA-REV-002 | MRR показатель | Корректное значение | [ ] | |
| SA-REV-003 | Когортный анализ | Таблица когорт | [ ] | |

---

## Фаза 4: CRM - Полный функционал

**После одобрения организации войти в CRM и протестировать:**

### 4.1 Основные модули

| ID | Модуль | Тестов | Passed | Failed | Комментарий |
|----|--------|--------|--------|--------|-------------|
| CRM-01 | Dashboard | 8 | [ ] | [ ] | |
| CRM-02 | Ученики (Pupils) | 28 | [ ] | [ ] | |
| CRM-03 | Группы (Groups) | 14 | [ ] | [ ] | |
| CRM-04 | Расписание (Schedule) | 17 | [ ] | [ ] | |
| CRM-05 | Лиды (Leads) | 11 | [ ] | [ ] | |
| CRM-06 | Канбан лидов | 11 | [ ] | [ ] | |
| CRM-07 | Платежи (Payments) | 14 | [ ] | [ ] | |
| CRM-08 | Тарифы (Tariffs) | 8 | [ ] | [ ] | |
| CRM-09 | Предметы (Subjects) | 5 | [ ] | [ ] | |
| CRM-10 | Пользователи (Users) | 8 | [ ] | [ ] | |
| CRM-11 | Зарплаты (Salaries) | 12 | [ ] | [ ] | |
| CRM-12 | Отчёты (Reports) | 8 | [ ] | [ ] | |
| CRM-13 | Посещаемость | 7 | [ ] | [ ] | |
| CRM-14 | Кабинеты (Rooms) | 5 | [ ] | [ ] | |
| CRM-15 | Способы оплаты | 6 | [ ] | [ ] | |
| CRM-16 | Шаблоны расписания | 9 | [ ] | [ ] | |
| CRM-17 | Настройки | 5 | [ ] | [ ] | |
| CRM-18 | SMS | 10 | [ ] | [ ] | |
| CRM-19 | WhatsApp | 15 | [ ] | [ ] | |
| CRM-20 | Уведомления | 6 | [ ] | [ ] | |
| CRM-21 | Подписка | 11 | [ ] | [ ] | |

**Детальные тест-кейсы:** см. файл `CRM_TEST_CASES.md`

---

## Фаза 5: Тестирование истечения подписки

### 5.1 Симуляция истечения

**SQL для симуляции:**
```sql
UPDATE organization_subscription
SET expires_at = DATE_SUB(NOW(), INTERVAL X DAY)
WHERE organization_id = ?;
```

| ID | Тест | Условие | Ожидаемый режим | Статус |
|----|------|---------|-----------------|--------|
| EXP-001 | День 0 | expires_at = NOW() | access_mode = limited | [ ] |
| EXP-002 | День 1-3 | expires_at = -3 дня | access_mode = limited | [ ] |
| EXP-003 | День 4 | expires_at = -4 дня | access_mode = read_only | [ ] |
| EXP-004 | День 10 | expires_at = -10 дней | access_mode = read_only | [ ] |
| EXP-005 | День 11+ | expires_at = -11 дней | access_mode = blocked | [ ] |

### 5.2 Проверка ограничений

| ID | Тест | Режим | Ожидаемый результат | Статус |
|----|------|-------|---------------------|--------|
| EXP-006 | Создание ученика | LIMITED | Запрещено | [ ] |
| EXP-007 | Редактирование ученика | LIMITED | Разрешено | [ ] |
| EXP-008 | Просмотр данных | READ_ONLY | Разрешено | [ ] |
| EXP-009 | Редактирование | READ_ONLY | Запрещено | [ ] |
| EXP-010 | Любое действие | BLOCKED | Только logout/payment | [ ] |

---

## Итоги тестирования

### Сводка по фазам

| Фаза | Всего тестов | Passed | Failed | Blocked | Примечание |
|------|-------------|--------|--------|---------|------------|
| Регистрация | 17 | | | | |
| SuperAdmin одобрение | 20 | | | | |
| SuperAdmin управление | 35 | | | | |
| CRM модули | 200+ | | | | |
| Истечение подписки | 10 | | | | |
| **ИТОГО** | **280+** | | | | |

### Критические баги

| ID | Описание | Приоритет | Статус |
|----|----------|-----------|--------|
| | | | |

### Улучшения (идеи во время тестирования)

| ID | Описание | Приоритет |
|----|----------|-----------|
| | | |

---

## Подписи

**Тестировщик:** _______________  **Дата:** _______________

**Руководитель:** _______________  **Дата:** _______________
